<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Jogo de Leitura</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      background: #f0f8ff;
      padding: 10px;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .placar {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin-bottom: 15px;
      font-size: 1.2rem;
      color: #1a237e;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .acertos, .erros {
      padding: 5px 15px;
      border-radius: 10px;
      color: white;
    }
    
    .acertos { background: #4CAF50; }
    .erros { background: #f44336; }
    
    .controle-volume {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    #volume {
      width: 80px;
    }
    
    .area-jogo {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .botao-audio {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: #2196F3;
      border: none;
      color: white;
      font-size: 1.8rem;
      margin: 10px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .botao-audio.tocando {
      background: #1976D2;
      transform: scale(0.95);
    }
    
    .resposta {
      font-size: 1.8rem;
      min-height: 50px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .opcoes {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      width: 100%;
      max-width: 350px;
      margin: 0 auto 15px;
      padding: 0 10px;
    }
    
    .opcao {
      padding: 10px 5px;
      font-size: 1.3rem;
      border: 2px solid #2196F3;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .opcao:hover, .opcao.selecionada {
      background: #2196F3;
      color: white;
    }
    
    .botao-ok {
      margin: 5px auto 10px;
      padding: 10px 25px;
      font-size: 1rem;
      background: #FF9800;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      display: block;
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .botao-ok:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .feedback {
      margin-top: 15px;
      font-size: 1.2rem;
      min-height: 30px;
    }
    
    .correto { color: #4CAF50; }
    .errado { color: #f44336; }
    
    @media (max-width: 400px) {
      .opcoes {
        grid-template-columns: 1fr 1fr;
        max-width: 300px;
        gap: 6px;
      }
      
      .opcao {
        padding: 8px 5px;
        font-size: 1.2rem;
        min-height: 45px;
      }
      
      .botao-audio {
        width: 65px;
        height: 65px;
        font-size: 1.6rem;
      }
      
      .resposta {
        font-size: 1.6rem;
        min-height: 45px;
      }
    }
  </style>
</head>
<body>
  <div class="placar">
    <div>Acertos: <span id="acertos">0</span></div>
    <div>Erros: <span id="erros">0</span></div>
    <div class="controle-volume">
      <span>üîà</span>
      <input type="range" id="volume" min="0" max="2" step="0.1" value="1">
      <span>üîä</span>
    </div>
  </div>
  
  <div class="area-jogo" style="text-align: center;">
    <button class="botao-audio" onclick="tocarAudio()" id="botaoAudio" style="margin: 0 auto 10px; display: block;">‚ñ∂Ô∏è</button>
    <h3 style="margin: 0 0 20px; color: #1a237e;">Qual s√≠laba voc√™ ouviu?</h3>
    
    <div class="resposta" id="resposta" style="font-size: 2rem; font-weight: bold; min-height: 60px; display: flex; align-items: center; justify-content: center;"></div>
    
    <!-- Mensagem de feedback -->
    <div id="feedback" style="min-height: 30px; text-align: center; margin: 10px 0; font-weight: bold;"></div>
    
    <!-- Mensagem de depura√ß√£o -->
    <div id="debug" style="color: red; font-size: 0.8rem; margin: 10px 0;"></div>
    
    <div class="opcoes" id="opcoes">
      <!-- Op√ß√µes ser√£o inseridas aqui via JavaScript -->
    </div>
    
    <div class="feedback" id="feedback"></div>
    
    <button class="botao-ok" onclick="verificarResposta()" id="btn-ok" disabled>OK</button>
  </div>

  <script>
    // Vari√°veis globais
    let silabaAtual = '';
    let respostaSelecionada = null;
    let acertos = 0;
    let erros = 0;
    
    // Lista de s√≠labas dispon√≠veis
    const silabas = [
      'ba', 'be', 'bi', 'bo', 'bu',
      'ca', 'ce', 'ci', 'co', 'cu',
      'da', 'de', 'di', 'do', 'du',
      'fa', 'fe', 'fi', 'fo', 'fu',
      'ga', 'ge', 'gi', 'go', 'gu'
    ];
    
    // Fun√ß√£o para verificar se um arquivo existe
    async function arquivoExiste(url) {
      try {
        const response = await fetch(url, { method: 'HEAD' });
        return response.ok;
      } catch {
        return false;
      }
    }
    
    // Vari√°vel para armazenar a inst√¢ncia de √°udio atual
    let audioAtual = null;
    
    // Inicializa o jogo quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function() {
      // Configura o controle de volume
      const controleVolume = document.getElementById('volume');
      if (controleVolume) {
        controleVolume.addEventListener('input', function(e) {
          const volume = parseFloat(e.target.value);
          if (audioAtual) {
            audioAtual.volume = volume;
          }
        });
      }
      // Verifica se a pasta de √°udios existe
      arquivoExiste('silabas_sons/ba.mp3').then(existe => {
        if (!existe) {
          document.getElementById('debug').textContent = 
            'ERRO: Pasta de √°udios n√£o encontrada ou sem permiss√£o de acesso.';
        }
      });
      // Inicia o jogo
      novaPergunta();
      
      // Adiciona evento de clique nas op√ß√µes
      document.getElementById('opcoes').addEventListener('click', function(e) {
        const opcao = e.target.closest('.opcao');
        if (!opcao) return;
        
        // Remove a sele√ß√£o de todas as op√ß√µes
        document.querySelectorAll('.opcao').forEach(btn => {
          btn.classList.remove('selecionada');
        });
        
        // Seleciona a op√ß√£o clicada
        opcao.classList.add('selecionada');
        respostaSelecionada = opcao.textContent;
        document.getElementById('btn-ok').disabled = false;
      });
    });
    
    // Fun√ß√£o para carregar e tocar √°udio com volume m√°ximo
    function tocarAudio() {
      const botaoAudio = document.querySelector('.botao-audio');
      
      // Se j√° estiver tocando, n√£o faz nada
      if (botaoAudio.classList.contains('tocando')) return;
      
      // Para qualquer √°udio que esteja tocando
      if (audioAtual) {
        audioAtual.pause();
        audioAtual.currentTime = 0;
      }
      
      // Cria um novo elemento de √°udio para cada reprodu√ß√£o
      audioAtual = new Audio();
      audioAtual.src = `silabas_sons/${silabaAtual}.mp3`;
      
      // Ajusta o volume conforme o controle
      const controleVolume = document.getElementById('volume');
      if (controleVolume) {
        audioAtual.volume = parseFloat(controleVolume.value);
      } else {
        audioAtual.volume = 1.0; // Volume m√°ximo como padr√£o
      }
      
      // Configura o √°udio para tocar em modo de alta pot√™ncia
      audioAtual.preload = 'auto';
      audioAtual.setAttribute('playsinline', '');
      audioAtual.muted = false;
      
      // Tenta reproduzir o √°udio
      const playPromise = audioAtual.play();
      
      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            botaoAudio.classList.add('tocando');
            audioAtual.onended = function() {
              botaoAudio.classList.remove('tocando');
            };
          })
          .catch(error => {
            console.error("Erro ao reproduzir √°udio:", error);
            // Tenta novamente com intera√ß√£o do usu√°rio
            document.body.addEventListener('click', function tentarNovamente() {
              audio.play().then(() => {
                botaoAudio.classList.add('tocando');
                audio.onended = function() {
                  botaoAudio.classList.remove('tocando');
                  audio.remove();
                };
                document.body.removeEventListener('click', tentarNovamente);
              });
            }, { once: true });
          });
      }
    }
    
    // Toca som de acerto
    function tocarSomAcerto() {
      // Para qualquer √°udio que esteja tocando
      if (audioAtual) {
        audioAtual.pause();
        audioAtual.currentTime = 0;
      }
      
      audioAtual = new Audio('sons/acerto.mp3');
      audioAtual.volume = document.getElementById('volume') ? parseFloat(document.getElementById('volume').value) : 1.0;
      audioAtual.preload = 'auto';
      audioAtual.load();
      // Tenta reproduzir o som
      const playPromise = audioAtual.play();
      if (playPromise !== undefined) {
        playPromise.catch(e => {
          console.error("Erro ao tocar som de acerto:", e);
          // Tenta novamente com intera√ß√£o do usu√°rio
          document.body.addEventListener('click', function tentarNovamente() {
            audio.play().finally(() => {
              document.body.removeEventListener('click', tentarNovamente);
            });
          }, { once: true });
        });
      }
    }
    
    // Toca som de erro
    function tocarSomErro() {
      // Para qualquer √°udio que esteja tocando
      if (audioAtual) {
        audioAtual.pause();
        audioAtual.currentTime = 0;
      }
      
      audioAtual = new Audio('sons/erro.mp3');
      audioAtual.volume = document.getElementById('volume') ? parseFloat(document.getElementById('volume').value) : 1.0;
      audioAtual.preload = 'auto';
      audioAtual.load();
      // Tenta reproduzir o som
      const playPromise = audioAtual.play();
      if (playPromise !== undefined) {
        playPromise.catch(e => {
          console.error("Erro ao tocar som de erro:", e);
          // Tenta novamente com intera√ß√£o do usu√°rio
          document.body.addEventListener('click', function tentarNovamente() {
            audio.play().finally(() => {
              document.body.removeEventListener('click', tentarNovamente);
            });
          }, { once: true });
        });
      }
    }
    
    // Verifica a resposta quando o bot√£o OK for clicado
    function verificarResposta() {
      if (!respostaSelecionada) return;
      
      const respostaElemento = document.getElementById('resposta');
      const feedbackElemento = document.getElementById('feedback');
      const btnOk = document.getElementById('btn-ok');
      const opcoesContainer = document.getElementById('opcoes');
      
      // Desabilita o bot√£o OK e as op√ß√µes
      btnOk.disabled = true;
      opcoesContainer.querySelectorAll('.opcao').forEach(opcao => {
        opcao.style.pointerEvents = 'none';
      });
      
      // Verifica se a resposta est√° correta
      if (respostaSelecionada === silabaAtual) {
        // Resposta correta
        acertos++;
        document.getElementById('acertos').textContent = acertos;
        respostaElemento.textContent = silabaAtual;
        respostaElemento.className = 'resposta correto';
        tocarSomAcerto();
        feedbackElemento.textContent = 'Parab√©ns! Voc√™ acertou! ‚úÖ';
        feedbackElemento.className = 'feedback correto';
      } else {
        // Resposta incorreta
        erros++;
        document.getElementById('erros').textContent = erros;
        respostaElemento.textContent = silabaAtual;
        respostaElemento.className = 'resposta errado';
        tocarSomErro();
        feedbackElemento.innerHTML = `Voc√™ respondeu: <strong>${respostaSelecionada}</strong><br>
                                   A resposta correta era: <strong>${silabaAtual}</strong>`;
        feedbackElemento.className = 'feedback errado';
      }
      
      // Prepara a pr√≥xima pergunta ap√≥s um breve atraso
      setTimeout(() => {
        respostaElemento.textContent = '?';
        respostaElemento.className = 'resposta';
        feedbackElemento.textContent = '';
        feedbackElemento.className = 'feedback';
        novaPergunta();
      }, 3000);
    }
    
    // Gera uma nova pergunta
    function novaPergunta() {
      // Limpa a sele√ß√£o
      respostaSelecionada = null;
      document.getElementById('resposta').textContent = '';
      document.getElementById('btn-ok').disabled = true;
      
      // Seleciona uma s√≠laba aleat√≥ria
      const indice = Math.floor(Math.random() * silabas.length);
      silabaAtual = silabas[indice];
      
      // Gera as op√ß√µes de resposta
      gerarOpcoes();
    }
    
    // Gera os bot√µes de op√ß√£o
    function gerarOpcoes() {
      const opcoesContainer = document.getElementById('opcoes');
      opcoesContainer.innerHTML = '';
      
      // Cria um array com 4 op√ß√µes (1 correta e 3 incorretas)
      let opcoes = [silabaAtual];
      
      // Adiciona 3 op√ß√µes incorretas
      while (opcoes.length < 4) {
        const indice = Math.floor(Math.random() * silabas.length);
        const opcao = silabas[indice];
        
        // Garante que n√£o haver√° op√ß√µes duplicadas
        if (!opcoes.includes(opcao)) {
          opcoes.push(opcao);
        }
      }
      
      // Embaralha as op√ß√µes
      opcoes = opcoes.sort(() => Math.random() - 0.5);
      
      // Cria os bot√µes de op√ß√£o
      opcoes.forEach(opcao => {
        const divOpcao = document.createElement('div');
        divOpcao.className = 'opcao';
        divOpcao.textContent = opcao;
        opcoesContainer.appendChild(divOpcao);
      });
      
      // Habilita os bot√µes de op√ß√£o
      opcoesContainer.querySelectorAll('.opcao').forEach(opcao => {
        opcao.style.pointerEvents = 'auto';
      });
    }
  </script>
</body>
</html>
